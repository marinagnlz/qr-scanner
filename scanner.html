const html5QrCode = new Html5Qrcode("reader");
html5QrCode.start(
  { facingMode: "environment" }, // cámara trasera
  {
    fps: 10,
    qrbox: 250
  },
  (decodedText, decodedResult) => {
    // Enviar solo el texto (no el objeto)
    console.log("Enviando código QR:", decodedText); // Asegúrate de que el código QR es el texto y no otro tipo de objeto
    window.parent.postMessage({ text: decodedText }, "*"); // Enviamos solo el texto
    // Detener el escaneo y cerrar la ventana
    html5QrCode.stop().then(() => {
      window.close();
    }).catch(err => {
      console.error("Error al detener el escáner", err);
      window.close();
    });
  },
  (errorMessage) => {
    // Puedes loguear si quieres los errores mientras escanea
    // console.warn("Escaneo fallido:", errorMessage);
  }
).catch(err => {
  console.error("No se pudo iniciar el escáner:", err);
});
debugger;
